{"version":3,"file":"compiler.js","sourceRoot":"","sources":["../../../../modules/@angular/compiler/src/compiler.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Compiler, CompilerFactory, CompilerOptions, ComponentResolver, Injectable, PLATFORM_DIRECTIVES, PLATFORM_PIPES, ReflectiveInjector, Type, ViewEncapsulation, isDevMode} from '@angular/core';\n\nexport * from './template_ast';\nexport {TEMPLATE_TRANSFORMS} from './template_parser';\nexport {CompilerConfig, RenderTypes} from './config';\nexport * from './compile_metadata';\nexport * from './offline_compiler';\nexport {RuntimeCompiler} from './runtime_compiler';\nexport * from './url_resolver';\nexport * from './xhr';\n\nexport {ViewResolver} from './view_resolver';\nexport {DirectiveResolver} from './directive_resolver';\nexport {PipeResolver} from './pipe_resolver';\n\nimport {TemplateParser} from './template_parser';\nimport {HtmlParser} from './html_parser';\nimport {DirectiveNormalizer} from './directive_normalizer';\nimport {CompileMetadataResolver} from './metadata_resolver';\nimport {StyleCompiler} from './style_compiler';\nimport {ViewCompiler} from './view_compiler/view_compiler';\nimport {AppModuleCompiler} from './app_module_compiler';\nimport {CompilerConfig} from './config';\nimport {RuntimeCompiler} from './runtime_compiler';\nimport {ElementSchemaRegistry} from './schema/element_schema_registry';\nimport {DomElementSchemaRegistry} from './schema/dom_element_schema_registry';\nimport {UrlResolver, DEFAULT_PACKAGE_URL_PROVIDER} from './url_resolver';\nimport {Parser} from './expression_parser/parser';\nimport {Lexer} from './expression_parser/lexer';\nimport {ViewResolver} from './view_resolver';\nimport {DirectiveResolver} from './directive_resolver';\nimport {PipeResolver} from './pipe_resolver';\nimport {Console, Reflector, reflector, ReflectorReader} from '../core_private';\nimport {XHR} from './xhr';\n\n/**\n * A set of providers that provide `RuntimeCompiler` and its dependencies to use for\n * template compilation.\n */\nexport const COMPILER_PROVIDERS: Array<any|Type|{[k: string]: any}|any[]> =\n    /*@ts2dart_const*/[\n      {provide: PLATFORM_DIRECTIVES, useValue: [], multi: true},\n      {provide: PLATFORM_PIPES, useValue: [], multi: true},\n      {provide: Reflector, useValue: reflector},\n      {provide: ReflectorReader, useExisting: Reflector},\n      Console,\n      Lexer,\n      Parser,\n      HtmlParser,\n      TemplateParser,\n      DirectiveNormalizer,\n      CompileMetadataResolver,\n      DEFAULT_PACKAGE_URL_PROVIDER,\n      StyleCompiler,\n      ViewCompiler,\n      AppModuleCompiler,\n      /*@ts2dart_Provider*/ {provide: CompilerConfig, useValue: new CompilerConfig()},\n      RuntimeCompiler,\n      /*@ts2dart_Provider*/ {provide: ComponentResolver, useExisting: RuntimeCompiler},\n      /*@ts2dart_Provider*/ {provide: Compiler, useExisting: RuntimeCompiler},\n      DomElementSchemaRegistry,\n      /*@ts2dart_Provider*/ {provide: ElementSchemaRegistry, useExisting: DomElementSchemaRegistry},\n      UrlResolver,\n      ViewResolver,\n      DirectiveResolver,\n      PipeResolver\n    ];\nexport class _RuntimeCompilerFactory extends CompilerFactory {\n  createCompiler(options: CompilerOptions): Compiler {\n    const deprecationMessages: string[] = [];\n    let platformDirectivesFromAppProviders: any[] = [];\n    let platformPipesFromAppProviders: any[] = [];\n    let compilerProvidersFromAppProviders: any[] = [];\n    let useDebugFromAppProviders: boolean;\n    let useJitFromAppProviders: boolean;\n    let defaultEncapsulationFromAppProviders: ViewEncapsulation;\n\n    if (options.deprecatedAppProviders && options.deprecatedAppProviders.length > 0) {\n      // Note: This is a hack to still support the old way\n      // of configuring platform directives / pipes and the compiler xhr.\n      // This will soon be deprecated!\n      const inj = ReflectiveInjector.resolveAndCreate(options.deprecatedAppProviders);\n      const compilerConfig: CompilerConfig = inj.get(CompilerConfig, null);\n      if (compilerConfig) {\n        platformDirectivesFromAppProviders = compilerConfig.deprecatedPlatformDirectives;\n        platformPipesFromAppProviders = compilerConfig.deprecatedPlatformPipes;\n        useJitFromAppProviders = compilerConfig.useJit;\n        useDebugFromAppProviders = compilerConfig.genDebugInfo;\n        defaultEncapsulationFromAppProviders = compilerConfig.defaultEncapsulation;\n        deprecationMessages.push(\n            `Passing a CompilerConfig to \"bootstrap()\" as provider is deprecated. Pass the provider via the new parameter \"compilerOptions\" of \"bootstrap()\" instead.`);\n      } else {\n        // If nobody provided a CompilerConfig, use the\n        // PLATFORM_DIRECTIVES / PLATFORM_PIPES values directly if existing\n        platformDirectivesFromAppProviders = inj.get(PLATFORM_DIRECTIVES, []);\n        if (platformDirectivesFromAppProviders.length > 0) {\n          deprecationMessages.push(\n              `Passing PLATFORM_DIRECTIVES to \"bootstrap()\" as provider is deprecated. Use the new parameter \"directives\" of \"bootstrap()\" instead.`);\n        }\n        platformPipesFromAppProviders = inj.get(PLATFORM_PIPES, []);\n        if (platformPipesFromAppProviders.length > 0) {\n          deprecationMessages.push(\n              `Passing PLATFORM_PIPES to \"bootstrap()\" as provider is deprecated. Use the new parameter \"pipes\" of \"bootstrap()\" instead.`);\n        }\n      }\n      const xhr = inj.get(XHR, null);\n      if (xhr) {\n        compilerProvidersFromAppProviders.push([{provide: XHR, useValue: xhr}]);\n        deprecationMessages.push(\n            `Passing an instance of XHR to \"bootstrap()\" as provider is deprecated. Pass the provider via the new parameter \"compilerOptions\" of \"bootstrap()\" instead.`);\n      }\n      // Need to copy console from deprecatedAppProviders to compiler providers\n      // as well so that we can test the above deprecation messages in old style bootstrap\n      // where we only have app providers!\n      const console = inj.get(Console, null);\n      if (console) {\n        compilerProvidersFromAppProviders.push([{provide: Console, useValue: console}]);\n      }\n    }\n\n    const injector = ReflectiveInjector.resolveAndCreate([\n      COMPILER_PROVIDERS, {\n        provide: CompilerConfig,\n        useFactory: (platformDirectives: any[], platformPipes: any[]) => {\n          return new CompilerConfig({\n            deprecatedPlatformDirectives:\n                _mergeArrays(platformDirectivesFromAppProviders, platformDirectives),\n            deprecatedPlatformPipes: _mergeArrays(platformPipesFromAppProviders, platformPipes),\n            // let explicit values from the compiler options overwrite options\n            // from the app providers. E.g. important for the testing platform.\n            genDebugInfo: _firstDefined(options.useDebug, useDebugFromAppProviders, isDevMode()),\n            // let explicit values from the compiler options overwrite options\n            // from the app providers\n            useJit: _firstDefined(options.useJit, useJitFromAppProviders, true),\n            // let explicit values from the compiler options overwrite options\n            // from the app providers\n            defaultEncapsulation: _firstDefined(\n                options.defaultEncapsulation, defaultEncapsulationFromAppProviders,\n                ViewEncapsulation.Emulated)\n          });\n        },\n        deps: [PLATFORM_DIRECTIVES, PLATFORM_PIPES]\n      },\n      // options.providers will always contain a provider for XHR as well\n      // (added by platforms). So allow compilerProvidersFromAppProviders to overwrite this\n      _mergeArrays(options.providers, compilerProvidersFromAppProviders)\n    ]);\n    const console: Console = injector.get(Console);\n    deprecationMessages.forEach((msg) => { console.warn(msg); });\n\n    return injector.get(Compiler);\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n}\n\n\nexport const RUNTIME_COMPILER_FACTORY = new _RuntimeCompilerFactory();\n\nfunction _firstDefined<T>(...args: T[]): T {\n  for (var i = 0; i < args.length; i++) {\n    if (args[i] !== undefined) {\n      return args[i];\n    }\n  }\n  return undefined;\n}\n\nfunction _mergeArrays(...parts: any[][]): any[] {\n  let result: any[] = [];\n  parts.forEach((part) => result.push(...part));\n  return result;\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}