{"version":3,"file":"compiler.js","sourceRoot":"","sources":["../../../../modules/@angular/compiler/src/compiler.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {COMPILER_OPTIONS, Compiler, CompilerFactory, CompilerOptions, Component, Inject, Injectable, OptionalMetadata, PLATFORM_INITIALIZER, PlatformRef, Provider, ReflectiveInjector, TRANSLATIONS, TRANSLATIONS_FORMAT, Type, ViewEncapsulation, createPlatformFactory, isDevMode, platformCore} from '@angular/core';\n\nexport * from './template_parser/template_ast';\nexport {TEMPLATE_TRANSFORMS} from './template_parser/template_parser';\nexport {CompilerConfig, RenderTypes} from './config';\nexport * from './compile_metadata';\nexport * from './offline_compiler';\nexport {RuntimeCompiler} from './runtime_compiler';\nexport * from './url_resolver';\nexport * from './resource_loader';\n\nexport {DirectiveResolver} from './directive_resolver';\nexport {PipeResolver} from './pipe_resolver';\nexport {NgModuleResolver} from './ng_module_resolver';\n\nimport {stringify} from './facade/lang';\nimport {ListWrapper} from './facade/collection';\nimport {TemplateParser} from './template_parser/template_parser';\nimport {HtmlParser} from './ml_parser/html_parser';\nimport {DirectiveNormalizer} from './directive_normalizer';\nimport {CompileMetadataResolver} from './metadata_resolver';\nimport {StyleCompiler} from './style_compiler';\nimport {ViewCompiler} from './view_compiler/view_compiler';\nimport {NgModuleCompiler} from './ng_module_compiler';\nimport {CompilerConfig} from './config';\nimport {RuntimeCompiler} from './runtime_compiler';\nimport {ElementSchemaRegistry} from './schema/element_schema_registry';\nimport {DomElementSchemaRegistry} from './schema/dom_element_schema_registry';\nimport {UrlResolver, DEFAULT_PACKAGE_URL_PROVIDER} from './url_resolver';\nimport {Parser} from './expression_parser/parser';\nimport {Lexer} from './expression_parser/lexer';\nimport {DirectiveResolver} from './directive_resolver';\nimport {PipeResolver} from './pipe_resolver';\nimport {NgModuleResolver} from './ng_module_resolver';\nimport {Console, Reflector, reflector, ReflectorReader, ReflectionCapabilities} from '../core_private';\nimport {ResourceLoader} from './resource_loader';\nimport * as i18n from './i18n/index';\n\nconst _NO_RESOURCE_LOADER: ResourceLoader = {\n  get(url: string): Promise<string>{\n      throw new Error(`No ResourceLoader implementation has been provided. Can't read the url \"${url}\"`);}\n};\n\n/**\n * A set of providers that provide `RuntimeCompiler` and its dependencies to use for\n * template compilation.\n */\nexport const COMPILER_PROVIDERS: Array<any|Type<any>|{[k: string]: any}|any[]> = [\n  {provide: Reflector, useValue: reflector},\n  {provide: ReflectorReader, useExisting: Reflector},\n  {provide: ResourceLoader, useValue: _NO_RESOURCE_LOADER},\n  Console,\n  Lexer,\n  Parser,\n  HtmlParser,\n  {\n    provide: i18n.HtmlParser,\n    useFactory: (parser: HtmlParser, translations: string, format: string) =>\n                    new i18n.HtmlParser(parser, translations, format),\n    deps: [\n      HtmlParser,\n      [new OptionalMetadata(), new Inject(TRANSLATIONS)],\n      [new OptionalMetadata(), new Inject(TRANSLATIONS_FORMAT)],\n    ]\n  },\n  TemplateParser,\n  DirectiveNormalizer,\n  CompileMetadataResolver,\n  DEFAULT_PACKAGE_URL_PROVIDER,\n  StyleCompiler,\n  ViewCompiler,\n  NgModuleCompiler,\n  {provide: CompilerConfig, useValue: new CompilerConfig()},\n  RuntimeCompiler,\n  {provide: Compiler, useExisting: RuntimeCompiler},\n  DomElementSchemaRegistry,\n  {provide: ElementSchemaRegistry, useExisting: DomElementSchemaRegistry},\n  UrlResolver,\n  DirectiveResolver,\n  PipeResolver,\n  NgModuleResolver\n];\n\nexport function analyzeAppProvidersForDeprecatedConfiguration(appProviders: any[] = []): {\n  compilerOptions: CompilerOptions,\n  moduleDeclarations: Type<any>[],\n  deprecationMessages: string[]\n} {\n  let compilerProviders: any[] = [];\n  let useDebug: boolean;\n  let useJit: boolean;\n  let defaultEncapsulation: ViewEncapsulation;\n  const deprecationMessages: string[] = [];\n\n  // Note: This is a hack to still support the old way\n  // of configuring platform directives / pipes and the compiler resource loader.\n  // This will soon be deprecated!\n  const tempInj = ReflectiveInjector.resolveAndCreate(appProviders);\n  const compilerConfig: CompilerConfig = tempInj.get(CompilerConfig, null);\n  if (compilerConfig) {\n    useJit = compilerConfig.useJit;\n    useDebug = compilerConfig.genDebugInfo;\n    defaultEncapsulation = compilerConfig.defaultEncapsulation;\n    deprecationMessages.push(\n        `Passing CompilerConfig as a regular provider is deprecated. Use \"compilerOptions\" use a custom \"CompilerFactory\" platform provider instead.`);\n  }\n  const resourceLoader = tempInj.get(ResourceLoader, null);\n  if (resourceLoader) {\n    compilerProviders.push([{provide: ResourceLoader, useValue: resourceLoader}]);\n    deprecationMessages.push(\n        `Passing ResourceLoader as regular provider is deprecated. Pass the provider via \"compilerOptions\" instead.`);\n  }\n  const compilerOptions: CompilerOptions = {\n    useJit: useJit,\n    useDebug: useDebug,\n    defaultEncapsulation: defaultEncapsulation,\n    providers: compilerProviders\n  };\n\n  return {compilerOptions, moduleDeclarations: [], deprecationMessages: deprecationMessages};\n}\nexport class RuntimeCompilerFactory implements CompilerFactory {\n  private _defaultOptions: CompilerOptions[];\n  constructor( defaultOptions: CompilerOptions[]) {\n    this._defaultOptions = [<CompilerOptions>{\n                             useDebug: isDevMode(),\n                             useJit: true,\n                             defaultEncapsulation: ViewEncapsulation.Emulated\n                           }].concat(defaultOptions);\n  }\n  createCompiler(options: CompilerOptions[] = []): Compiler {\n    const mergedOptions = _mergeOptions(this._defaultOptions.concat(options));\n    const injector = ReflectiveInjector.resolveAndCreate([\n      COMPILER_PROVIDERS, {\n        provide: CompilerConfig,\n        useFactory: () => {\n          return new CompilerConfig({\n            // let explicit values from the compiler options overwrite options\n            // from the app providers. E.g. important for the testing platform.\n            genDebugInfo: mergedOptions.useDebug,\n            // let explicit values from the compiler options overwrite options\n            // from the app providers\n            useJit: mergedOptions.useJit,\n            // let explicit values from the compiler options overwrite options\n            // from the app providers\n            defaultEncapsulation: mergedOptions.defaultEncapsulation,\n            logBindingUpdate: mergedOptions.useDebug\n          });\n        },\n        deps: []\n      },\n      mergedOptions.providers\n    ]);\n    return injector.get(Compiler);\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: {type: Function, decorators?: DecoratorInvocation[]}[] = [\n{type: Array, decorators: [{ type: Inject, args: [COMPILER_OPTIONS, ] }, ]},\n];\n}\n\nfunction _initReflector() {\n  reflector.reflectionCapabilities = new ReflectionCapabilities();\n}\n\n/**\n * A platform that included corePlatform and the compiler.\n *\n * @experimental\n */\nexport const platformCoreDynamic = createPlatformFactory(platformCore, 'coreDynamic', [\n  {provide: COMPILER_OPTIONS, useValue: {}, multi: true},\n  {provide: CompilerFactory, useClass: RuntimeCompilerFactory},\n  {provide: PLATFORM_INITIALIZER, useValue: _initReflector, multi: true},\n]);\n\nfunction _mergeOptions(optionsArr: CompilerOptions[]): CompilerOptions {\n  return {\n    useDebug: _lastDefined(optionsArr.map(options => options.useDebug)),\n    useJit: _lastDefined(optionsArr.map(options => options.useJit)),\n    defaultEncapsulation: _lastDefined(optionsArr.map(options => options.defaultEncapsulation)),\n    providers: _mergeArrays(optionsArr.map(options => options.providers))\n  };\n}\n\nfunction _lastDefined<T>(args: T[]): T {\n  for (var i = args.length - 1; i >= 0; i--) {\n    if (args[i] !== undefined) {\n      return args[i];\n    }\n  }\n  return undefined;\n}\n\nfunction _mergeArrays(parts: any[][]): any[] {\n  let result: any[] = [];\n  parts.forEach((part) => part && result.push(...part));\n  return result;\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}