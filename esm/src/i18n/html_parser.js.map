{"version":3,"file":"html_parser.js","sourceRoot":"","sources":["../../../../../../modules/@angular/compiler/src/i18n/html_parser.ts"],"names":[],"mappings":"AAAA;;;;;;GAMG;OAGI,EAAC,4BAA4B,EAAsB,MAAM,mCAAmC;OAC5F,EAAC,eAAe,EAAC,MAAM,qBAAqB;OAE5C,EAAC,iBAAiB,EAAC,MAAM,oBAAoB;OAC7C,EAAC,aAAa,EAAC,MAAM,kBAAkB;OACvC,EAAC,GAAG,EAAC,MAAM,mBAAmB;OAC9B,EAAC,iBAAiB,EAAC,MAAM,sBAAsB;AAEtD;IAIE,8EAA8E;IAC9E,uBAAuB;IACvB,qEAAqE;IACrE,YAAoB,WAA2B,EAAU,aAAsB;QAA3D,gBAAW,GAAX,WAAW,CAAgB;QAAU,kBAAa,GAAb,aAAa,CAAS;IAAG,CAAC;IAEnF,KAAK,CACD,MAAc,EAAE,GAAW,EAAE,mBAAmB,GAAY,KAAK,EACjE,mBAAmB,GAAwB,4BAA4B;QACzE,MAAM,WAAW,GACb,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,mBAAmB,EAAE,mBAAmB,CAAC,CAAC;QAElF,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,KAAK,EAAE,CAAC,CAAC,CAAC;YACrD,4DAA4D;YAC5D,MAAM,CAAC,WAAW,CAAC;QACrB,CAAC;QAED,yDAAyD;QACzD,MAAM,aAAa,GAAG,IAAI,aAAa,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;QAClE,MAAM,MAAM,GAAG,aAAa,CAAC,kBAAkB,CAAC,MAAM,EAAE,GAAG,EAAE,mBAAmB,CAAC,CAAC;QAElF,EAAE,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;YAC5B,MAAM,CAAC,IAAI,eAAe,CAAC,WAAW,CAAC,SAAS,EAAE,WAAW,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;QACvF,CAAC;QAED,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,mBAAmB,CAAC,CAAC;QAC3D,MAAM,iBAAiB,GAAG,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,GAAG,EAAE,aAAa,EAAE,GAAG,CAAC,CAAC;QAE9F,MAAM,eAAe,GACjB,iBAAiB,CAAC,WAAW,CAAC,SAAS,EAAE,iBAAiB,EAAE,mBAAmB,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;QAE7F,MAAM,CAAC,IAAI,eAAe,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;IAClD,CAAC;AACH,CAAC;AAAA","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {HtmlParser as BaseHtmlParser} from '../ml_parser/html_parser';\nimport {DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig} from '../ml_parser/interpolation_config';\nimport {ParseTreeResult} from '../ml_parser/parser';\n\nimport {mergeTranslations} from './extractor_merger';\nimport {MessageBundle} from './message_bundle';\nimport {Xtb} from './serializers/xtb';\nimport {TranslationBundle} from './translation_bundle';\n\nexport class HtmlParser implements BaseHtmlParser {\n  // @override\n  public getTagDefinition: any;\n\n  // TODO(vicb): transB.load() should not need a msgB & add transB.resolve(msgB,\n  // interpolationConfig)\n  // TODO(vicb): remove the interpolationConfig from the Xtb serializer\n  constructor(private _htmlParser: BaseHtmlParser, private _translations?: string) {}\n\n  parse(\n      source: string, url: string, parseExpansionForms: boolean = false,\n      interpolationConfig: InterpolationConfig = DEFAULT_INTERPOLATION_CONFIG): ParseTreeResult {\n    const parseResult =\n        this._htmlParser.parse(source, url, parseExpansionForms, interpolationConfig);\n\n    if (!this._translations || this._translations === '') {\n      // Do not enable i18n when no translation bundle is provided\n      return parseResult;\n    }\n\n    // TODO(vicb): add support for implicit tags / attributes\n    const messageBundle = new MessageBundle(this._htmlParser, [], {});\n    const errors = messageBundle.updateFromTemplate(source, url, interpolationConfig);\n\n    if (errors && errors.length) {\n      return new ParseTreeResult(parseResult.rootNodes, parseResult.errors.concat(errors));\n    }\n\n    const xtb = new Xtb(this._htmlParser, interpolationConfig);\n    const translationBundle = TranslationBundle.load(this._translations, url, messageBundle, xtb);\n\n    const translatedNodes =\n        mergeTranslations(parseResult.rootNodes, translationBundle, interpolationConfig, [], {});\n\n    return new ParseTreeResult(translatedNodes, []);\n  }\n}\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}