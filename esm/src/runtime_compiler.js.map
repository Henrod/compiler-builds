{"version":3,"file":"runtime_compiler.js","sourceRoot":"","sources":["../../../../../modules/@angular/compiler/src/runtime_compiler.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ComponentFactory, ComponentResolver, Injectable} from '@angular/core';\n\nimport {BaseException} from '../src/facade/exceptions';\nimport {IS_DART, Type, isBlank, isString} from '../src/facade/lang';\n\nimport {ListWrapper,} from '../src/facade/collection';\nimport {PromiseWrapper} from '../src/facade/async';\nimport {createHostComponentMeta, CompileDirectiveMetadata, CompilePipeMetadata, CompileIdentifierMetadata} from './compile_metadata';\nimport {TemplateAst,} from './template_ast';\nimport {StyleCompiler, StylesCompileDependency, StylesCompileResult} from './style_compiler';\nimport {ViewCompiler, ViewFactoryDependency, ComponentFactoryDependency} from './view_compiler/view_compiler';\nimport {TemplateParser} from './template_parser';\nimport {DirectiveNormalizer} from './directive_normalizer';\nimport {CompileMetadataResolver} from './metadata_resolver';\nimport {CompilerConfig} from './config';\nimport * as ir from './output/output_ast';\nimport {jitStatements} from './output/output_jit';\nimport {interpretStatements} from './output/output_interpreter';\nimport {InterpretiveAppViewInstanceFactory} from './output/interpretive_view';\nimport {XHR} from './xhr';\nexport class RuntimeCompiler implements ComponentResolver {\n  private _styleCache: Map<string, Promise<string>> = new Map<string, Promise<string>>();\n  private _hostCacheKeys = new Map<Type, any>();\n  private _compiledTemplateCache = new Map<any, CompiledTemplate>();\n\n  constructor(\n      private _metadataResolver: CompileMetadataResolver,\n      private _templateNormalizer: DirectiveNormalizer, private _templateParser: TemplateParser,\n      private _styleCompiler: StyleCompiler, private _viewCompiler: ViewCompiler, private _xhr: XHR,\n      private _genConfig: CompilerConfig) {}\n\n  resolveComponent(component: Type|string): Promise<ComponentFactory<any>> {\n    if (isString(component)) {\n      return PromiseWrapper.reject(\n          new BaseException(`Cannot resolve component using '${component}'.`), null);\n    }\n    return this._loadAndCompileHostComponent(<Type>component).done;\n  }\n\n  clearCache(): void {\n    this._styleCache.clear();\n    this._compiledTemplateCache.clear();\n    this._hostCacheKeys.clear();\n  }\n\n  private _loadAndCompileHostComponent(componentType: Type): CompileHostTemplate {\n    var compMeta: CompileDirectiveMetadata =\n        this._metadataResolver.getDirectiveMetadata(componentType);\n    var hostCacheKey = this._hostCacheKeys.get(compMeta.type.runtime);\n    if (isBlank(hostCacheKey)) {\n      hostCacheKey = new Object();\n      this._hostCacheKeys.set(compMeta.type.runtime, hostCacheKey);\n      assertComponent(compMeta);\n      var hostMeta: CompileDirectiveMetadata =\n          createHostComponentMeta(compMeta.type, compMeta.selector);\n\n      this._loadAndCompileComponent(hostCacheKey, hostMeta, [compMeta], [], []);\n    }\n    var compTemplate = this._compiledTemplateCache.get(hostCacheKey);\n    return new CompileHostTemplate(compTemplate, compMeta);\n  }\n\n  private _loadAndCompileComponent(\n      cacheKey: any, compMeta: CompileDirectiveMetadata, viewDirectives: CompileDirectiveMetadata[],\n      pipes: CompilePipeMetadata[], compilingComponentsPath: any[]): CompiledTemplate {\n    var compiledTemplate = this._compiledTemplateCache.get(cacheKey);\n    if (isBlank(compiledTemplate)) {\n      let done =\n          PromiseWrapper\n              .all([<any>this._compileComponentStyles(compMeta)].concat(viewDirectives.map(\n                  dirMeta => this._templateNormalizer.normalizeDirective(dirMeta))))\n              .then((stylesAndNormalizedViewDirMetas: any[]) => {\n                var normalizedViewDirMetas = stylesAndNormalizedViewDirMetas.slice(1);\n                var styles = stylesAndNormalizedViewDirMetas[0];\n                var parsedTemplate = this._templateParser.parse(\n                    compMeta, compMeta.template.template, normalizedViewDirMetas, pipes,\n                    compMeta.type.name);\n\n                var childPromises: Promise<any>[] = [];\n                compiledTemplate.init(this._compileComponent(\n                    compMeta, parsedTemplate, styles, pipes, compilingComponentsPath,\n                    childPromises));\n                return PromiseWrapper.all(childPromises).then((_) => { return compiledTemplate; });\n              });\n      compiledTemplate = new CompiledTemplate(done);\n      this._compiledTemplateCache.set(cacheKey, compiledTemplate);\n    }\n    return compiledTemplate;\n  }\n\n  private _compileComponent(\n      compMeta: CompileDirectiveMetadata, parsedTemplate: TemplateAst[], styles: string[],\n      pipes: CompilePipeMetadata[], compilingComponentsPath: any[],\n      childPromises: Promise<any>[]): Function {\n    var compileResult = this._viewCompiler.compileComponent(\n        compMeta, parsedTemplate,\n        new ir.ExternalExpr(new CompileIdentifierMetadata({runtime: styles})), pipes);\n    compileResult.dependencies.forEach((dep) => {\n      if (dep instanceof ViewFactoryDependency) {\n        let childCompilingComponentsPath = ListWrapper.clone(compilingComponentsPath);\n        let childCacheKey = dep.comp.type.runtime;\n        let childViewDirectives: CompileDirectiveMetadata[] =\n            this._metadataResolver.getViewDirectivesMetadata(dep.comp.type.runtime);\n        let childViewPipes: CompilePipeMetadata[] =\n            this._metadataResolver.getViewPipesMetadata(dep.comp.type.runtime);\n        let childIsRecursive = childCompilingComponentsPath.indexOf(childCacheKey) > -1 ||\n            childViewDirectives.some(\n                dir => childCompilingComponentsPath.indexOf(dir.type.runtime) > -1);\n        childCompilingComponentsPath.push(childCacheKey);\n\n        let childComp = this._loadAndCompileComponent(\n            dep.comp.type.runtime, dep.comp, childViewDirectives, childViewPipes,\n            childCompilingComponentsPath);\n        dep.placeholder.runtime = childComp.proxyViewFactory;\n        dep.placeholder.name = `viewFactory_${dep.comp.type.name}`;\n        if (!childIsRecursive) {\n          // Only wait for a child if it is not a cycle\n          childPromises.push(childComp.done);\n        }\n      } else if (dep instanceof ComponentFactoryDependency) {\n        let childComp = this._loadAndCompileHostComponent(dep.comp.runtime);\n        dep.placeholder.runtime = childComp.componentFactory;\n        dep.placeholder.name = `compFactory_${dep.comp.name}`;\n        childPromises.push(childComp.done);\n      }\n    });\n    var factory: any;\n    if (IS_DART || !this._genConfig.useJit) {\n      factory = interpretStatements(\n          compileResult.statements, compileResult.viewFactoryVar,\n          new InterpretiveAppViewInstanceFactory());\n    } else {\n      factory = jitStatements(\n          `${compMeta.type.name}.template.js`, compileResult.statements,\n          compileResult.viewFactoryVar);\n    }\n    return factory;\n  }\n\n  private _compileComponentStyles(compMeta: CompileDirectiveMetadata): Promise<string[]> {\n    var compileResult = this._styleCompiler.compileComponent(compMeta);\n    return this._resolveStylesCompileResult(compMeta.type.name, compileResult);\n  }\n\n  private _resolveStylesCompileResult(sourceUrl: string, result: StylesCompileResult):\n      Promise<string[]> {\n    var promises = result.dependencies.map((dep) => this._loadStylesheetDep(dep));\n    return PromiseWrapper.all(promises)\n        .then((cssTexts) => {\n          var nestedCompileResultPromises: Promise<string[]>[] = [];\n          for (var i = 0; i < result.dependencies.length; i++) {\n            var dep = result.dependencies[i];\n            var cssText = cssTexts[i];\n            var nestedCompileResult =\n                this._styleCompiler.compileStylesheet(dep.moduleUrl, cssText, dep.isShimmed);\n            nestedCompileResultPromises.push(\n                this._resolveStylesCompileResult(dep.moduleUrl, nestedCompileResult));\n          }\n          return PromiseWrapper.all(nestedCompileResultPromises);\n        })\n        .then((nestedStylesArr) => {\n          for (var i = 0; i < result.dependencies.length; i++) {\n            var dep = result.dependencies[i];\n            dep.valuePlaceholder.runtime = nestedStylesArr[i];\n            dep.valuePlaceholder.name = `importedStyles${i}`;\n          }\n          if (IS_DART || !this._genConfig.useJit) {\n            return interpretStatements(\n                result.statements, result.stylesVar, new InterpretiveAppViewInstanceFactory());\n          } else {\n            return jitStatements(`${sourceUrl}.css.js`, result.statements, result.stylesVar);\n          }\n        });\n  }\n\n  private _loadStylesheetDep(dep: StylesCompileDependency): Promise<string> {\n    var cacheKey = `${dep.moduleUrl}${dep.isShimmed ? '.shim' : ''}`;\n    var cssTextPromise = this._styleCache.get(cacheKey);\n    if (isBlank(cssTextPromise)) {\n      cssTextPromise = this._xhr.get(dep.moduleUrl);\n      this._styleCache.set(cacheKey, cssTextPromise);\n    }\n    return cssTextPromise;\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: {type: Function, decorators?: DecoratorInvocation[]}[] = [\n{type: CompileMetadataResolver, },\n{type: DirectiveNormalizer, },\n{type: TemplateParser, },\n{type: StyleCompiler, },\n{type: ViewCompiler, },\n{type: XHR, },\n{type: CompilerConfig, },\n];\n}\n\nclass CompileHostTemplate {\n  componentFactory: ComponentFactory<any>;\n  done: Promise<ComponentFactory<any>>;\n  constructor(_template: CompiledTemplate, compMeta: CompileDirectiveMetadata) {\n    this.componentFactory = new ComponentFactory<any>(\n        compMeta.selector, _template.proxyViewFactory, compMeta.type.runtime);\n    this.done = _template.done.then((_) => this.componentFactory);\n  }\n}\n\nclass CompiledTemplate {\n  private _viewFactory: Function = null;\n  proxyViewFactory: Function;\n  constructor(public done: Promise<CompiledTemplate>) {\n    this.proxyViewFactory =\n        (viewUtils: any /** TODO #9100 */, childInjector: any /** TODO #9100 */,\n         contextEl: any /** TODO #9100 */) =>\n            this._viewFactory(viewUtils, childInjector, contextEl);\n  }\n\n  init(viewFactory: Function) { this._viewFactory = viewFactory; }\n}\n\nfunction assertComponent(meta: CompileDirectiveMetadata) {\n  if (!meta.isComponent) {\n    throw new BaseException(`Could not compile '${meta.type.name}' because it is not a component.`);\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}